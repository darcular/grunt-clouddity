var servers = [ {
  "id" : "c5b0e7f5-dc88-465d-b669-2d3c523e0551",
  "name" : "oa-1-loadbalancer",
  "status" : "RUNNING",
  "hostId" : "ee60f9247f97f26ca2dff485dd7f3e80b383fef2342992e7a52a4c3f",
  "addresses" : {
    "public" : [ "115.146.95.21" ],
    "private" : []
  },
  "imageId" : "81f6b78f-6d51-4de9-a464-91d47543d4ba",
  "flavorId" : "885227de-b7ee-42af-a209-2f1ff59bc330",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-11-18T06:56:22Z",
  "updated" : "2015-11-18T06:56:45Z"
}, {
  "id" : "9c62e0c2-4e2a-42c4-92b1-727518472fd6",
  "name" : "oa-3-computing",
  "status" : "RUNNING",
  "hostId" : "8a2eee14c3f83ab9ebabaf33a2065a89dcb154e13b5e3ce0afb0b2ce",
  "addresses" : {
    "public" : [ "115.146.95.215" ],
    "private" : []
  },
  "imageId" : "81f6b78f-6d51-4de9-a464-91d47543d4ba",
  "flavorId" : "885227de-b7ee-42af-a209-2f1ff59bc330",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-11-18T06:56:22Z",
  "updated" : "2015-11-18T06:56:56Z"
}, {
  "id" : "686856fa-2456-4942-be52-682057991c96",
  "name" : "oa-2-computing",
  "status" : "RUNNING",
  "hostId" : "ee60f9247f97f26ca2dff485dd7f3e80b383fef2342992e7a52a4c3f",
  "addresses" : {
    "public" : [ "115.146.95.214" ],
    "private" : []
  },
  "imageId" : "81f6b78f-6d51-4de9-a464-91d47543d4ba",
  "flavorId" : "885227de-b7ee-42af-a209-2f1ff59bc330",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-11-18T06:56:21Z",
  "updated" : "2015-11-18T06:57:06Z"
}, {
  "id" : "9a612da7-0fff-43d5-a87e-45d3926f7d13",
  "name" : "oa-1-computing",
  "status" : "RUNNING",
  "hostId" : "8a2eee14c3f83ab9ebabaf33a2065a89dcb154e13b5e3ce0afb0b2ce",
  "addresses" : {
    "public" : [ "115.146.95.208" ],
    "private" : []
  },
  "imageId" : "81f6b78f-6d51-4de9-a464-91d47543d4ba",
  "flavorId" : "885227de-b7ee-42af-a209-2f1ff59bc330",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-11-18T06:56:21Z",
  "updated" : "2015-11-18T06:57:16Z"
}, {
  "id" : "b268c827-7b59-4b80-9c6f-687e620de9d3",
  "name" : "rstudio",
  "status" : "RUNNING",
  "hostId" : "8a2eee14c3f83ab9ebabaf33a2065a89dcb154e13b5e3ce0afb0b2ce",
  "addresses" : {
    "public" : [ "115.146.95.58" ],
    "private" : []
  },
  "imageId" : "81f6b78f-6d51-4de9-a464-91d47543d4ba",
  "flavorId" : "cba9ea52-8e90-468b-b8c2-777a94d81ed3",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-11-02T10:58:20Z",
  "updated" : "2015-11-03T04:32:49Z"
}, {
  "id" : "333ffa04-42c5-4af6-9e7d-5ad5df8a052a",
  "name" : "wps3",
  "status" : "RUNNING",
  "hostId" : "8ee5839d15105b0163158e5338f4c408bbe685fb743b7f63f5ea5009",
  "addresses" : {
    "public" : [ "115.146.94.126" ],
    "private" : []
  },
  "imageId" : "2a882d9c-3185-414c-9683-a4646b5c785e",
  "flavorId" : "1",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-09-22T05:20:46Z",
  "updated" : "2015-10-29T06:31:21Z"
}, {
  "id" : "a0830b86-3879-49d0-a27e-911b766b467e",
  "name" : "wps2",
  "status" : "RUNNING",
  "hostId" : "a9978f7aeb6e4aa34cb2fcc45cef8addd48570142d2225f930b854ea",
  "addresses" : {
    "public" : [ "115.146.94.140" ],
    "private" : []
  },
  "imageId" : "2a882d9c-3185-414c-9683-a4646b5c785e",
  "flavorId" : "1",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-09-21T02:08:30Z",
  "updated" : "2015-10-06T06:30:22Z"
}, {
  "id" : "7e0f34b1-a674-4a44-ad47-204aa23f2702",
  "name" : "lb",
  "status" : "RUNNING",
  "hostId" : "cb1cb1733ccaa0ed896f934a9d936940ff79ea9144e519cec2669d82",
  "addresses" : {
    "public" : [ "115.146.94.139" ],
    "private" : []
  },
  "imageId" : "2a882d9c-3185-414c-9683-a4646b5c785e",
  "flavorId" : "cba9ea52-8e90-468b-b8c2-777a94d81ed3",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-09-21T02:07:47Z",
  "updated" : "2015-10-06T06:42:09Z"
}, {
  "id" : "3be80eee-df06-4e8b-92a2-b4c15db9a0dd",
  "name" : "wfs2",
  "status" : "RUNNING",
  "hostId" : "15137be4c6327e46ad79a3d5f5406ba6c19c5cd8000a550b929c4a56",
  "addresses" : {
    "public" : [ "115.146.93.175" ],
    "private" : []
  },
  "imageId" : "2a882d9c-3185-414c-9683-a4646b5c785e",
  "flavorId" : "1",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-09-18T07:08:57Z",
  "updated" : "2015-10-06T06:29:16Z"
}, {
  "id" : "afc47854-8f3f-427d-b1f9-4b902d3809f6",
  "name" : "wfs1",
  "status" : "RUNNING",
  "hostId" : "cb1cb1733ccaa0ed896f934a9d936940ff79ea9144e519cec2669d82",
  "addresses" : {
    "public" : [ "115.146.93.147" ],
    "private" : []
  },
  "imageId" : "2a882d9c-3185-414c-9683-a4646b5c785e",
  "flavorId" : "1",
  "progress" : 0,
  "metadata" : {},
  "created" : "2015-09-18T07:03:48Z",
  "updated" : "2015-10-06T06:42:09Z"
} ];

var grunt= require("grunt"); // XXX
var gruntFile= require("./Gruntfile.js")(grunt); // XXX
var options= grunt.config().clouddity; // XXX
console.log(JSON.stringify(options)); // XXX

var expect = require("chai").expect;
var SandboxedModule = require("sandboxed-module");
// var utils = require("../lib/utils.js");

var utils = SandboxedModule.require("../lib/utils.js", {
  requires : {
    pkgcloud : {
      compute : {
        createClient : function() {
          return {
            getServers : function(options, callback) {
              return callback(null, servers);
            }
          }
        }
      }
    }
  },
  globals : [],
  locals : {}
});
// var utils = require("../lib/utils.js");

describe("clouddity", function() {

  describe("iterateOverNodes", function() {

    it("should return node names", function(done) {
      utils.iterateOverNodes(options, [{name:"oa-1-computing"}, {name:"oa-2-computing"}, {name:"oa-3-computing"}], function(data, cb) {
        console.log("XXX " + data); // XXX
        console.log(JSON.stringify(data)); // XXX
        cb();
      }, done);
    });
  });

});